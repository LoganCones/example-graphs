library(shiny)
library(shinyalert)
library(DT)

ui <- fluidPage(
  shinyalert::useShinyalert(),
  
  actionButton("action", "Submit"),
  
  DT::dataTableOutput("datatable")
)

server <- function(input, output, session) {
  processing <- reactiveVal(FALSE)
  
  observeEvent(input$action, {
    shinyalert(
      title = 'Test',
      class = 'confirm',
      text = 'Please confirm your submission',
      type = 'warning',
      showCancelButton = TRUE,
      confirmButtonText = 'Confirmed',
      cancelButtonText = 'Cancel',
      callbackR = function(value) {
        if (value) {
          processing(TRUE)
          shinyalert("Processing", type = 'info', showConfirmButton = FALSE)
          
          # Simulate loading time
          Sys.sleep(3)
          
          # Update the datatableOutput with new data
          newData <- data.frame(
            Name = c("John", "Jane", "Sam"),
            Age = c(25, 32, 40),
            stringsAsFactors = FALSE
          )
          
          output$datatable <- DT::renderDataTable({
            processing(FALSE)
            DT::datatable(newData)
          })
        } else {
          shinyalert('Submission canceled', type = 'info')
        }
      }
    )
  })
  
  observe({
    if (processing()) {
      shinyalert_update("Processing", type = "info")
    } else {
      shinyalert_update("Success", type = "success")
      Sys.sleep(2)
      shinyalert_close()
    }
  })
  
  output$datatable <- DT::renderDataTable({
    data.frame()
  })
}

shinyApp(ui, server)
