library(shiny)
library(shinyalert)
library(DT)
library(shinyjs)

ui <- fluidPage(
  shinyalert::useShinyalert(),
  shinyjs::useShinyjs(),
  
  actionButton("action", "Submit"),
  
  DT::dataTableOutput("datatable")
)

server <- function(input, output, session) {
  processing <- reactiveVal(FALSE)
  
  observeEvent(input$action, {
    shinyalert(
      title = 'Test',
      class = 'confirm',
      text = 'Please confirm your submission',
      type = 'warning',
      showCancelButton = TRUE,
      confirmButtonText = 'Confirmed',
      cancelButtonText = 'Cancel',
      callbackR = function(value) {
        if (value) {
          processing(TRUE)
          shinyjs::disable("action")  # Disable the action button
          shinyalert("Processing", type = 'info', showConfirmButton = FALSE)
          
          # Simulate loading time
          Sys.sleep(3)
          
          # Update the datatableOutput with new data
          newData <- data.frame(
            Name = c("John", "Jane", "Sam"),
            Age = c(25, 32, 40),
            stringsAsFactors = FALSE
          )
          
          output$datatable <- DT::renderDataTable({
            processing(FALSE)
            shinyjs::enable("action")  # Enable the action button
            DT::datatable(newData)
          })
          
          shinyjs::runjs('$("#processingAlert").modal("hide");')  # Hide the processing alert
          shinyalert("Success", type = 'success', showConfirmButton = FALSE)
          shinyjs::runjs('setTimeout(function() { $(".shinyalert-container").remove(); }, 2000);')  # Close the success alert after 2 seconds
        } else {
          shinyalert('Submission canceled', type = 'info')
        }
      }
    )
  })
  
  output$datatable <- DT::renderDataTable({
    data.frame()
  })
}

shinyApp(ui, server)
